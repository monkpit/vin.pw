{% extends 'base/base.html' %}
{% block content %}
<div class="container-fluid">
	<div class="row">&nbsp;</div>
	<div class="row">&nbsp;</div>
	<div class="row">&nbsp;</div>
	<div class="form-horizontal" style='clear: all'>
		<label class="sr-only" for="vinfield"></label>
		<input name="vin_number" class="form-control" id="vinfield" placeholder="Enter a VIN">
	</div>
	<div class="row">
		<button id="decode-button" class="btn btn-default disabled" style="position:fixed; bottom: 0px; width:100%; height:20%;">Decode!</button>
	</div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/vindata.js') }}"></script>
<script>
function parse_wmi(vin){
	var WMI = vin.substr(0,2)
	var regions_and_regexes = get_vindata_specific_regions();
	
	for (var location in regions_and_regexes){
		var matches = WMI.match(regions_and_regexes[location])
		if (matches) {
			return {"Region": location}
		}
	}
}
function decode_vin(vin){
	console.log(parse_wmi(vin));
}
function process_decode_button_press(e){
	var vin_value = $('input#vinfield').val();
	var vin_data = decode_vin(vin_value);
	//update page with vin_data
}
function validate_vinfield(event, element){
	var vin_value = undefined;
	if (element==undefined) {
		vin_value = $(this).val();
	} else {
		vin_value = element.val();
	}
	button = $('button#decode-button');
	vin_is_valid = (vin_value.length == 17);

	button.toggleClass('disabled', !vin_is_valid);
	if (vin_is_valid){
		button.addClass('btn-success').removeClass('btn-default');
	} else {
		button.addClass('btn-default').removeClass('btn-success');
	}

	if (!(typeof e === 'undefined')) {
		e.stopPropagation();
	}
}
$('input#vinfield').on('keyup', validate_vinfield);
$('button#decode-button').on('click', process_decode_button_press);
validate_vinfield(undefined, $('input#vinfield'));

test_vin = 'JF1VA2L67F9821007';
</script>
{% endblock %}
